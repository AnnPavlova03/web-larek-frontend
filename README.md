# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные используемые в приложении 

Данные пользователя, приходящие с сервера
```
export interface ICard {
	id: string;
	description?: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```
Интерфейс для модели данных карточек
```
export interface ICardList {
	cards: ICard[];
	preview: string | null; 
	getCard(id: string): ICard;
}
```
Интерфейс корзины
```
export interface IBasket {
	count: number;
	toggleOrderedCard(id:string, isInclude: boolean):TProduct | null 
	getTotal(): number 
	deleteProduct(Id: string, payload: Function | null): void; 
	updateBasket(card: ICard, payload: Function | null): void;  
	checkStateButton(isInclude: boolean):void 
}
```
Интерфейс заказа
```
export interface IPayment {
	address: string | number;
	buttonPay: boolean; //кнопка онлайн или при получении
}
```
Интерфейс контактных данных покупателя
```
export interface IContacts {
	email: string;
	phone: number;
}
```
Данные товара при добавление его в корзину
```
export type TProduct = Pick<ICard, 'id' | 'title' | 'price'>; 
```
Данные форм
```
export type TForm = IContacts & IPayment; 
```
Тип для хранения ошибок формы
```
export type TFormErrors = Partial<Record<keyof TForm, string>>
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsList
Класс отвечает за хранение и логику работы с данными карточек\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы для работы с данными.
- getCard(id: string): ICard - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Basket
Класс отвечает за логику работы корзины
В полях класса хранятся следующие данные:
	count: number; - количество карточек добавленных в корзину

Методы для работы с данными.
- toggleOrderedCard(id:string, isInclude: boolean):TProduct - не дает добавить одинаковые товары
- getTotal(): number -  получаем сумму заказа
- deleteProduct(Id: string, payload: Function | null): void; - удаляем товары в корхине 
- updateBasket(card: ICard, payload: Function | null): void;  - обновляем состояние корзины после удаления или добавления товара 
- checkStateButton(isInclude: boolean):void - если добавлена бесценная карточка, блокируем кнопку 

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Общай класс для всех модальных окон, в нем реализуются методы открытия и закрытия окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор модального окна(класс из DOM) и брокер событий

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий
- template:  HTMLTemplateElement -  темплейт для различного отображения карточки  

#### Класс ModalWithConfirm
Расширяет класс Modal. Предназначен для реализации модального окна подтверждения При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнения при сабмите формы.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения (если добавлен бесценный товар)
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения
- buttonsOrder?: HTMLButtonElement - Кнопка выбора оплаты
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- setStateButtonsOrder(isChosen:boolean)-изменяет состояние выбранного способа оплаты 
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithImage
Расширяет класс Modal. Предназначен для реализации модального окна с изображением в большом размере. При открытии модального окна получает данные изображения, которое нужно показать.\
Поля класса:
- imageElement: HTMLImageElement - элемент разметки с изображением
- imageCaption: HTMLElement - элемент разметки для вывода названия изображения

Методы:
- open(data: { name: string, link: string }): void - расширение родительского метода, принимает данные изображения, которые используются для заполнения атрибутов элементов модального окна.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.

#### Класс Card 
Отвечает за отображение карточки, задавая в карточке данные категории, названия, изображения, стоиости. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливается слушатель на всю карточку, при нажатии на которую генерируется событие открытия попапа (подробное описание товара)\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер _id возвращает уникальный id карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

